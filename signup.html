<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affiliate Registration - Meta Injector Pro</title>
    
    <link rel="icon" href="./Source_Files/favicon.ico" sizes="any">
    <link rel="icon" href="./Source_Files/icon.svg" type="image/svg+xml">

    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { background-color: #0F0A1E; font-family: 'Plus Jakarta Sans', sans-serif; color: white; }
        .glass-panel { background: rgba(255, 255, 255, 0.03); backdrop-filter: blur(20px); border: 1px solid rgba(255, 255, 255, 0.08); }
        .input-field { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); color: white; transition: all 0.3s; }
        .input-field:focus { border-color: #A073EE; outline: none; box-shadow: 0 0 10px rgba(160,115,238,0.2); }
        .input-error { border-color: #ef4444 !important; }
        
        /* Custom Radio Style */
        .custom-radio { accent-color: #A073EE; width: 1.1rem; height: 1.1rem; cursor: pointer; }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4 relative">

    <div id="successModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black/80 hidden backdrop-blur-sm">
        <div class="glass-panel p-8 rounded-2xl max-w-md w-full text-center transform transition-all scale-100">
            <div class="w-20 h-20 bg-green-500/20 rounded-full flex items-center justify-center mx-auto mb-6">
                <svg class="w-10 h-10 text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path></svg>
            </div>
            <h2 class="text-3xl font-bold text-white mb-2">Success! üéâ</h2>
            <p class="text-gray-300 mb-8">Account created successfully! A confirmation email has been sent.</p>
            <a href="login.html" class="block w-full py-4 rounded-xl font-bold text-white bg-gradient-to-r from-[#A073EE] to-[#fd297b] hover:opacity-90 transition-opacity">
                Go to Login
            </a>
        </div>
    </div>

    <div class="glass-panel w-full max-w-lg p-8 rounded-2xl shadow-2xl my-10">
        
        <div class="mb-8 relative">
            <a href="affiliate.html" class="absolute left-0 top-2 text-gray-400 hover:text-[#A073EE] transition-colors p-1" title="Back to Home">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
                </svg>
            </a>
            <div class="text-center">
                <img src="./Source_Files/logo.svg" alt="Logo" class="h-10 mx-auto mb-4">
                <h2 class="text-2xl font-bold">Create Affiliate Account</h2>
            </div>
        </div>

        <form id="signupForm" class="space-y-4">
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">First Name</label>
                    <input type="text" id="firstName" required class="w-full px-4 py-3 rounded-lg input-field" placeholder="John">
                </div>
                <div>
                    <label class="block text-xs font-medium text-gray-400 mb-1">Last Name</label>
                    <input type="text" id="lastName" required class="w-full px-4 py-3 rounded-lg input-field" placeholder="Doe">
                </div>
            </div>

            <div>
                <label class="block text-xs font-medium text-gray-400 mb-1">Email Address</label>
                <input type="email" id="email" required class="w-full px-4 py-3 rounded-lg input-field" placeholder="john@example.com">
            </div>
            <div>
                <label class="block text-xs font-medium text-gray-400 mb-1">Phone Number</label>
                <input type="tel" id="phone" required class="w-full px-4 py-3 rounded-lg input-field" placeholder="017xxxxxxxx">
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div class="relative">
                    <label class="block text-xs font-medium text-gray-400 mb-1">Password</label>
                    <input type="password" id="password" required class="w-full px-4 py-3 rounded-lg input-field pr-10" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <button type="button" onclick="togglePass('password', 'eye1')" class="absolute right-3 top-[28px] text-gray-400 hover:text-white">
                        <svg id="eye1" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                    </button>
                </div>

                <div class="relative">
                    <label class="block text-xs font-medium text-gray-400 mb-1">Retype Password</label>
                    <input type="password" id="confirmPassword" required class="w-full px-4 py-3 rounded-lg input-field pr-10" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
                    <button type="button" onclick="togglePass('confirmPassword', 'eye2')" class="absolute right-3 top-[28px] text-gray-400 hover:text-white">
                        <svg id="eye2" class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/></svg>
                    </button>
                </div>
            </div>
            <p id="passError" class="text-red-500 text-xs font-bold hidden bg-red-500/10 p-2 rounded mt-1">‚ö†Ô∏è Passwords do not match!</p>

            <div class="border-t border-white/10 my-4"></div>

            <div class="p-4 rounded-xl bg-white/5 border border-white/10">
                <label class="block text-sm font-medium text-gray-300 mb-3">Do you have a YouTube Channel or Facebook Page?</label>
                <div class="flex gap-6 mb-2">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="hasSocial" id="socialYes" value="yes" class="custom-radio">
                        <span class="text-sm text-gray-300">Yes</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="hasSocial" id="socialNo" value="no" class="custom-radio" checked>
                        <span class="text-sm text-gray-300">No</span>
                    </label>
                </div>
                
                <div id="socialDetails" class="hidden mt-4 space-y-3">
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Channel / Page Link</label>
                        <input type="url" id="socialLink" class="w-full px-4 py-2.5 rounded-lg input-field border-[#A073EE]/40" placeholder="https://youtube.com/...">
                    </div>
                    <div>
                        <label class="block text-xs text-gray-400 mb-1">Total Subscribers / Followers</label>
                        <input type="number" id="followerCount" class="w-full px-4 py-2.5 rounded-lg input-field border-[#A073EE]/40" placeholder="e.g. 15000">
                    </div>
                </div>
            </div>

            <div class="p-4 rounded-xl bg-white/5 border border-white/10 mt-2">
                <label class="block text-sm font-medium text-gray-300 mb-3">Are you a Meta Injector Pro user?</label>
                <div class="flex gap-6 mb-2">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="isMetaUser" id="metaYes" value="yes" class="custom-radio">
                        <span class="text-sm text-gray-300">Yes</span>
                    </label>
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="radio" name="isMetaUser" id="metaNo" value="no" class="custom-radio" checked>
                        <span class="text-sm text-gray-300">No</span>
                    </label>
                </div>
                
                <div id="metaDetails" class="hidden mt-4">
                    <label class="block text-xs text-gray-400 mb-1">Software Account Details</label>
                    <input type="text" id="metaUserDetail" class="w-full px-4 py-2.5 rounded-lg input-field border-[#A073EE]/40" placeholder="Enter email or phone used in software">
                </div>
            </div>

            <button type="submit" class="w-full py-4 rounded-xl font-bold text-white bg-gradient-to-r from-[#A073EE] to-[#fd297b] hover:opacity-90 shadow-lg shadow-[#A073EE]/20 transition-all mt-6">
                Create Account
            </button>
        </form>

        <p class="text-center text-gray-400 text-sm mt-6">
            Already have an account? <a href="login.html" class="text-[#A073EE] font-bold hover:underline">Login</a>
        </p>
    </div>

    <script>
        ['firstName', 'lastName'].forEach(id => {
            document.getElementById(id).addEventListener('input', function(e) {
                this.value = this.value.replace(/[^a-zA-Z\s]/g, '');
            });
        });

        document.getElementById('phone').addEventListener('input', function(e) {
            this.value = this.value.replace(/[^0-9]/g, '');
        });

        const passInput = document.getElementById('password');
        const confirmInput = document.getElementById('confirmPassword');
        const errorMsg = document.getElementById('passError');

        function checkPasswords() {
            const p1 = passInput.value;
            const p2 = confirmInput.value;
            if (p2 && p1 !== p2) {
                errorMsg.classList.remove('hidden');
                confirmInput.classList.add('input-error');
            } else {
                errorMsg.classList.add('hidden');
                confirmInput.classList.remove('input-error');
            }
        }
        passInput.addEventListener('input', checkPasswords);
        confirmInput.addEventListener('input', checkPasswords);

        function togglePass(inputId, iconId) {
            const input = document.getElementById(inputId);
            const icon = document.getElementById(iconId);
            if(input.type === "password") {
                input.type = "text";
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.875 18.825A10.05 10.05 0 0112 19c-4.478 0-8.268-2.943-9.543-7a9.97 9.97 0 011.563-3.029m5.858.908a3 3 0 114.243 4.243M9.878 9.878l4.242 4.242M9.88 9.88l-3.29-3.29m7.532 7.532l3.29 3.29M3 3l3.59 3.59m0 0A9.953 9.953 0 0112 5c4.478 0 8.268 2.943 9.543 7a10.025 10.025 0 01-4.132 5.411m0 0L21 21"/>';
            } else {
                input.type = "password";
                icon.innerHTML = '<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>';
            }
        }

        const socialYes = document.getElementById('socialYes');
        const socialNo = document.getElementById('socialNo');
        const socialDetails = document.getElementById('socialDetails');

        socialYes.addEventListener('change', () => socialDetails.classList.remove('hidden'));
        socialNo.addEventListener('change', () => socialDetails.classList.add('hidden'));

        const metaYes = document.getElementById('metaYes');
        const metaNo = document.getElementById('metaNo');
        const metaDetails = document.getElementById('metaDetails');

        metaYes.addEventListener('change', () => metaDetails.classList.remove('hidden'));
        metaNo.addEventListener('change', () => metaDetails.classList.add('hidden'));

        document.getElementById('signupForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const pass = passInput.value;
            const confirmPass = confirmInput.value;
            const email = document.getElementById('email').value.trim();

            if(pass !== confirmPass) {
                errorMsg.classList.remove('hidden');
                return;
            }

            const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            if (!emailRegex.test(email)) {
                alert("Please enter a valid email address.");
                return;
            }

            const btn = e.target.querySelector('button[type="submit"]');
            const originalText = btn.innerText;
            btn.innerText = "Creating Account...";
            btn.disabled = true;

            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const phone = document.getElementById('phone').value.trim();

            const hasSocial = socialYes.checked;
            const socialLink = hasSocial ? document.getElementById('socialLink').value.trim() : "";
            const followerCount = hasSocial ? document.getElementById('followerCount').value.trim() : "";

            const isMetaUser = metaYes.checked;
            const metaUserDetail = isMetaUser ? document.getElementById('metaUserDetail').value.trim() : "";

            try {
                const res = await fetch('/.netlify/functions/create-affiliate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        firstName, lastName, email, phone, password: pass, 
                        isMetaUser, metaUserDetail,
                        hasSocial, socialLink, followerCount
                    })
                });

                const result = await res.json();

                if (res.ok) {
                    document.getElementById('successModal').classList.remove('hidden');
                } else {
                    alert("Error: " + result.error);
                }
            } catch (error) {
                alert("Network Error: " + error.message);
            } finally {
                btn.innerText = originalText;
                btn.disabled = false;
            }
        });
    </script>
</body>
</html>
